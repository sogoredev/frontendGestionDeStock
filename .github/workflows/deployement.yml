name: Build and Push Frontend Docker Image

on:
  push:
    branches:
      - main  # Déclenche ce workflow uniquement sur des pushs sur la branche 'main'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # 2. List files to verify the folder structure
      - name: List files in repository
        run: |
          echo "Listing all files in the repository..."
          ls -alh

      # 3. Set up Docker Buildx
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 4. Log in to Docker Hub
      - name: Log in to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}  # Token Docker Hub (stocké dans les secrets GitHub)

      # 5. Build the Docker image 1
      - name: Build Docker Image
        run: |
          docker build -t sogoredev/stock-front:${{ github.sha }} -f Dockerfile .
          # Le tag 'github.sha' permet de taguer l'image avec l'ID unique du commit GitHub pour une version unique
          # Si tu veux aussi utiliser un tag 'latest', tu peux l'ajouter :
          # docker tag sogoredev/stock-front:${{ github.sha }} sogoredev/stock-front:latest

      # 6. Push the Docker image to Docker Hub
      - name: Push Docker Image
        run: |
          docker push sogoredev/stock-front:${{ github.sha }}
          # Optionnellement, tu peux aussi pousser la version 'latest' si tu l'as taguée :
          # docker push sogoredev/stock-front:latest
