name: Deploy Frontend to VPS
on: [push]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Build Docker Image for Frontend
        run: |
          docker build -t stock-frontend:${{github.sha}} -f frontend/Dockerfile .

      - name: SSH into VPS and Deploy Frontend
        uses: appleboy/ssh-action@v1.2.0
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.PRIVATE_KEY }}
          script: |
            cd /opt/applications/stock/frontend
            docker-compose pull
            docker-compose up -d
